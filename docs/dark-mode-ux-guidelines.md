# 다크모드 UX 가이드라인

## 개요

이 문서는 개인 GitHub 블로그 프로젝트의 다크모드 구현과 유지보수를 위한 포괄적인 UX 가이드라인입니다. 사용자 경험의 일관성과 접근성을 보장하며, 개발 과정에서 발생할 수 있는 기술적 이슈를 예방하기 위한 체계적인 접근 방법을 제시합니다.

**대상 독자**: 개발자, 디자이너, QA 팀원  
**마지막 업데이트**: 2025-08-20  
**버전**: 1.0

---

## 🌙 다크모드 UX 정책

### 1. 일관성 원칙 (Consistency)

#### 1.1 전역 동기화
- **모든 UI 요소**는 테마 전환 시 **즉시 반영**되어야 함
- 사이드바, 헤더, 메인 콘텐츠, 푸터 등 **전체 영역 동기화**
- 페이지 간 이동 시에도 선택된 테마 유지
- 새로고침 후에도 사용자가 선택한 테마 상태 보존

#### 1.2 시각적 일관성
- 라이트/다크 모드에서 **동일한 UI 구조** 유지
- 색상만 변경되고 레이아웃이나 간격은 불변
- 브랜드 아이덴티티가 두 테마에서 일관되게 표현

### 2. 접근성 원칙 (Accessibility)

#### 2.1 색상 대비 준수
- **WCAG 2.1 AA 기준**: 최소 4.5:1 색상 대비 비율 준수
- 다크모드에서 텍스트 가독성 최우선
- 중요한 UI 요소(버튼, 링크)는 7:1 대비 비율 권장

#### 2.2 시각적 피드백
- 테마 전환 버튼의 **현재 상태 명확히 표시**
- 라이트/다크/시스템 모드 구분을 위한 아이콘 사용
- 호버 상태와 활성 상태의 시각적 구분

#### 2.3 키보드 접근성
- 테마 전환 기능의 키보드 네비게이션 지원
- Tab 순서에 따른 논리적 포커스 이동
- 스크린 리더 사용자를 위한 적절한 aria-label 제공

### 3. 사용자 경험 원칙 (User Experience)

#### 3.1 즉시성
- 테마 전환 버튼 클릭 즉시 **전체 UI 변경** (로딩 시간 없음)
- 페이지 새로고침이나 추가 액션 불필요
- 부분적 업데이트나 깜박임 현상 금지

#### 3.2 기억성
- 사용자 선택의 **영구 저장** (localStorage 활용)
- 브라우저 세션 종료 후에도 설정 유지
- 다중 디바이스 간 동기화는 향후 고려사항

#### 3.3 예측성
- **라이트/다크/시스템** 모드의 명확한 구분
- 시스템 모드 시 OS 설정 변경에 자동 반응
- 사용자가 예상하는 색상 변화 패턴 준수

---

## 🔧 기술적 구현 정책

### 1. CSS 아키텍처 규칙

#### 1.1 변수 정의 순서 (고정 규칙)
```css
/* 1단계: 라이트모드 기본값 */
:root { 
  --sidebar: hsl(0 0% 98%); 
}

/* 2단계: 다크모드 메인 테마 */
.dark { 
  --color-background: oklch(12% 0 0); 
}

/* 3단계: Tailwind 연결 */
@theme inline { 
  --color-sidebar: var(--sidebar); 
}

/* 4단계: 다크모드 사이드바 오버라이드 (핵심!) */
.dark { 
  --sidebar: hsl(240 5.9% 10%); 
}
```

**⚠️ 중요**: 이 순서를 변경하면 다크모드가 작동하지 않음

#### 1.2 색상 형식 정책
- **메인 테마 변수**: OKLCH 형식 유지 (더 정확한 색상 표현)
- **사이드바 변수**: HSL 형식 유지 (검증된 안정성)
- **혼재 허용**: 기능성 > 완벽한 통일성
- **변경 금지**: 작동하는 색상 값은 불필요한 변경 피함

#### 1.3 변수 네이밍 규칙
```css
--sidebar-*              /* 원본 변수 (HSL 값) */
--color-sidebar-*        /* Tailwind 연결 변수 */
--color-background       /* 메인 테마 변수 (OKLCH 값) */
```

### 2. 컴포넌트 구현 규칙

#### 2.1 테마 상태 관리
- **단일 진실 공급원**: `useThemeStore` 사용
- 다른 상태 관리 라이브러리와 충돌 방지
- 테마 로직의 중앙 집중식 관리

#### 2.2 컴포넌트 설계 원칙
- CSS 클래스는 Shadcn UI 패턴 준수
- `text-sidebar-foreground`, `bg-sidebar-accent` 등 사용
- 하드코딩된 색상 값 사용 금지

#### 2.3 개발 중 디버깅
- **프로덕션 코드에 console.log 제거**
- 임시 디버깅 코드는 커밋 전 정리
- 디버깅이 필요한 경우 개발 전용 브랜치 사용

### 3. 점진적 개선 원칙

#### 3.1 우선순위
1. **기능성**: 테마 전환이 올바르게 작동
2. **일관성**: 모든 UI 요소가 동기화
3. **최적화**: 성능 개선 및 코드 품질

#### 3.2 변경 관리
- 작동하는 코드 우선, 최적화는 차후
- 대규모 리팩토링보다 점진적 개선 선호
- 사용자 경험에 영향을 주는 변경사항 우선 처리

---

## 🧪 QA 검증 체크리스트

### 1. 기능성 검증 (필수)

#### 테마 전환 기본 기능
- [ ] 테마 토글 버튼 클릭 시 즉시 변경
- [ ] 라이트 → 다크 → 시스템 → 라이트 순환 작동
- [ ] 모든 페이지에서 테마 전환 정상 작동
- [ ] 브라우저 새로고침 후 테마 상태 유지

#### 전체 UI 동기화
- [ ] 사이드바와 메인 콘텐츠 색상 동기화
- [ ] 헤더, 푸터 영역 테마 반영
- [ ] 모든 버튼, 카드, 입력 필드 색상 일치
- [ ] 경계선(border) 색상 통일성

#### 반응형 및 다중 환경
- [ ] 모바일 환경에서 테마 전환 정상
- [ ] 데스크톱 환경에서 테마 전환 정상
- [ ] 태블릿 크기에서도 일관된 동작
- [ ] 다양한 브라우저(Chrome, Safari, Firefox)에서 검증

### 2. 접근성 검증

#### 색상 대비 검증
- [ ] 다크모드 텍스트 대비 4.5:1 이상
- [ ] 라이트모드 텍스트 대비 4.5:1 이상
- [ ] 링크와 버튼의 7:1 대비 권장 달성
- [ ] 색상 대비 검사 도구로 자동 검증

#### 키보드 네비게이션
- [ ] Tab 키로 테마 전환 버튼 도달 가능
- [ ] Enter 또는 Space키로 테마 전환 가능
- [ ] 포커스 인디케이터 명확히 표시
- [ ] 스크린 리더 호환성 (aria-label 확인)

#### 사용성 검증
- [ ] 현재 테마 상태를 시각적으로 구분 가능
- [ ] 테마 전환 버튼의 의미가 직관적
- [ ] 시스템 모드 시 OS 설정 변경에 반응
- [ ] 로딩 상태나 깜박임 없이 즉시 전환

### 3. 성능 검증

#### 렌더링 성능
- [ ] 테마 전환 시 페이지 렌더링 지연 없음
- [ ] 메모리 누수 확인 (개발자 도구 활용)
- [ ] CSS 리플로우/리페인트 최소화
- [ ] 번들 크기에 미치는 영향 확인

---

## 📋 변경 관리 정책

### 1. 수정 시 원칙

#### 사전 준비
1. **백업 우선**: 현재 작동하는 상태를 Git으로 커밋
2. **브랜치 생성**: 테마 관련 변경사항은 별도 브랜치에서 작업
3. **이슈 문서화**: 해결하려는 문제를 명확히 정의

#### 수정 과정
1. **단계적 검증**: 한 번에 하나씩 변경 후 즉시 테스트
2. **CSS 순서 주의**: 변수 정의 순서 변경 시 특히 신중
3. **전체 테스트**: 모든 페이지에서 테마 전환 검증

#### 사후 처리
1. **롤백 준비**: 실패 시 즉시 이전 상태로 복원
2. **문서 업데이트**: 변경사항을 이 가이드라인에 반영
3. **팀 공유**: 중요한 변경사항은 팀원들과 공유

### 2. 금지 사항

#### 절대 변경 금지
- 작동하는 CSS 변수 순서 임의 변경
- 검증되지 않은 색상 값으로 대량 교체
- 프로덕션 환경에서 직접 실험

#### 주의 사항
- Shadcn UI 업데이트 시 테마 영향도 확인
- TailwindCSS 버전 업그레이드 시 색상 변수 호환성 검증
- 새로운 UI 컴포넌트 추가 시 다크모드 지원 필수

---

## 🔍 코드 리뷰 체크포인트

### 1. CSS 변경사항 리뷰

#### 필수 확인 항목
- [ ] CSS 변수 정의 순서가 가이드라인 준수
- [ ] 새로 추가된 색상 변수가 다크모드에서도 정의됨
- [ ] 하드코딩된 색상 값 사용 여부 확인
- [ ] Shadcn UI 네이밍 규칙 준수 여부

#### 위험도 평가
**🔴 고위험 (필수 QA 검증)**
- `.dark` 블록 순서 변경
- 사이드바 관련 변수 수정
- `@theme inline` 블록 변경

**🟡 중위험 (권장 QA 검증)**
- 새로운 색상 변수 추가
- 기존 색상 값 수정
- TailwindCSS 클래스 대량 변경

**🟢 저위험 (기본 검토)**
- 주석 추가/수정
- 변수명 변경 (값 동일)
- 코드 정리 및 포맷팅

### 2. 컴포넌트 변경사항 리뷰

#### React 컴포넌트
- [ ] `useThemeStore` 사용법이 올바른지 확인
- [ ] 테마 관련 로직이 중앙집중화되어 있는지
- [ ] 불필요한 리렌더링을 유발하지 않는지
- [ ] 임시 디버깅 코드가 제거되었는지

#### UI 컴포넌트
- [ ] 새로운 컴포넌트가 다크모드를 지원하는지
- [ ] Shadcn UI 패턴을 올바르게 따르는지
- [ ] 접근성 속성(aria-label 등)이 적절한지
- [ ] 모바일 환경에서도 정상 작동하는지

---

## 🚨 트러블슈팅 가이드

### 1. 자주 발생하는 문제들

#### 사이드바가 다크모드로 변경되지 않음
**원인**: CSS 변수 정의 순서 문제  
**해결**: `.dark` 블록이 `@theme inline` 다음에 위치하는지 확인

#### 일부 컴포넌트만 테마 변경 안됨
**원인**: 하드코딩된 색상 값 사용  
**해결**: CSS 변수나 Tailwind 클래스로 변경

#### 페이지 새로고침 후 테마 초기화
**원인**: localStorage 저장/로드 로직 문제  
**해결**: `useThemeStore`의 `onRehydrateStorage` 확인

#### 테마 전환이 느림
**원인**: 불필요한 리렌더링 또는 CSS 성능 문제  
**해결**: React DevTools로 렌더링 최적화

### 2. 디버깅 방법

#### CSS 변수 확인
```javascript
// 브라우저 콘솔에서 실행
const styles = getComputedStyle(document.documentElement);
console.log('Sidebar color:', styles.getPropertyValue('--sidebar'));
console.log('Dark class:', document.documentElement.classList.contains('dark'));
```

#### 컴포넌트 상태 확인
```javascript
// React DevTools에서 useThemeStore 상태 확인
// 또는 임시로 콘솔 로그 추가 (커밋 전 제거)
```

---

## 📚 참고 자료

### 외부 문서
- [WCAG 2.1 색상 대비 가이드라인](https://www.w3.org/WAI/WCAG21/Understanding/contrast-minimum.html)
- [Shadcn UI 다크모드 구현](https://ui.shadcn.com/docs/dark-mode)
- [TailwindCSS 다크모드](https://tailwindcss.com/docs/dark-mode)

### 프로젝트 내부 문서
- `docs/prd.md` - 프로젝트 요구사항
- `docs/architecture.md` - 시스템 아키텍처
- `src/stores/useThemeStore.ts` - 테마 상태 관리

### 도구 및 검증
- [WebAIM Contrast Checker](https://webaim.org/resources/contrastchecker/) - 색상 대비 검증
- [WAVE Web Accessibility Evaluator](https://wave.webaim.org/) - 접근성 검증
- Chrome DevTools Lighthouse - 성능 및 접근성 종합 검증

---

## 📝 변경 이력

| 날짜 | 버전 | 변경 내용 | 작성자 |
|------|------|-----------|---------|
| 2025-08-20 | 1.0 | 초기 가이드라인 작성 - 사이드바 다크모드 이슈 해결 과정을 바탕으로 체계적 정책 수립 | UX Expert (Sally) |

---

**💡 이 가이드라인에 대한 피드백이나 개선사항이 있으면 언제든 팀에 공유해주세요!**